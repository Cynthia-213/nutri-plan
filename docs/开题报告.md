# 绪论

## 研究背景和意义

### 研究背景

随着我国社会经济进入高质量发展阶段，居民生活模式发生了结构性改变。现代办公环境中长期的久坐行为、高油高糖的西方化饮食结构，叠加碎片化时间导致的体育锻炼缺失，使得能量代谢失衡问题在全球范围内愈演愈烈。据《中国居民营养与慢性病状况报告》权威数据显示，我国成年人中超重及肥胖人数占比已跨越 50% 的红线，热量摄入超标与身体活动不足已成为诱发糖尿病、心血管疾病等慢性病发病率攀升的首要诱因。

在这样的背景下，科学的健康管理变得至关重要。体重管理的核心遵循热量平衡定律，即个体能量摄入与总能量消耗之间的动态博弈。当摄入大于消耗时，多余的热量会以脂肪形式储存，导致体重增加；反之，则体重减少。因此，精确记录每日的饮食摄入和运动消耗，是实现热量收支平衡、进行有效健康管理的基础。

然而，现有的健康管理实践面临感知偏差与工具匮乏的双重挑战。传统的热量记录方式，如手动记账，不仅繁琐、耗时，而且难以保证数据的准确性，难以实现对微观营养素及宏量热量的精确量化。市面上虽有众多健康应用，但部分存在功能单一、数据不准确、缺乏个性化指导等问题。

在当前大语言模型飞速发展的背景下，健康管理正由数据记录向智能决策转型。用户亟需一个能够针对中国膳食习惯、基于科学计算模型、并能通过 AI 提供实时纠偏建议的闭环系统。因此，开发一个集结构化饮食监测、动态运动跟踪及 AI 驱动的个性化推荐于一体的热量收支平衡系统具有重要的现实需求和应用价值。

### 研究意义

本研究通过设计并实现个人饮食运动热量收支平衡系统，不仅为个体健康管理提供数字化工具，更在提升管理精度与决策智能化方面具有深远意义：

1. **推动健康管理的精准化与科学化**：本研究将经典的 Mifflin-St Jeor 基础代谢模型与 MET 运动当量模型深度集成。通过算法解耦基础生存热量与主动运动增量，解决了传统管理中能量消耗估算粗放的痛点。这种基于严谨数学模型的量化方式，能够显著提升个人热量收支监测的科学性，使体重管理从感性认知转向数据驱动”。
2. **提供个性化的智能健康指导**：系统不仅作为数据存储终端，还能基于用户的个人身体数据（如身高、体重、年龄、活动水平）和健康目标（减重、增肌、维持），提供个性化的每日热量预算。结合 AI 技术，系统还能生成智能化的饮食建议，帮助用户在控制总热量的同时，优化营养结构。
3. **构建本地化的食物与运动数据库**：系统整合权威的食物营养成分数据（如中国食物成分表、USDA数据），使得热量计算更为精准，并且实现了宏量营养素与常见微量元素的量化，更具实用价值。更通过开放式数据导入接口赋予了系统极高的扩展性，支持用户根据地域差异或新兴食品自主完善库储备。
4. **强化数字健康反馈机制与行为重塑**：通过数据可视化技术展示热量收支趋势与体重追踪曲线，能够为用户提供直观的正向激励与预警机制。这种高频、实时的交互反馈有助于提高用户健康管理的依从性，从而在根本上促进健康生活方式的长期养成。

综上所述，本系统的实现不仅是对现有健康管理工具的补充和优化，更是对“数字健康”理念的一次具体实践。它通过技术手段赋能个人，使其能够更主动、更科学地管理自身健康，对于提升全民健康素养、预防慢性疾病具有积极的社会意义。

## 主要研究内容及论文结构

### 研究内容

本研究的核心是设计、开发和实现一个功能完善的个人饮食运动热量收支平衡系统（Nutri-Plan）。主要研究内容涵盖了系统的前后端开发、数据库设计以及核心算法的实现。具体包括：

**1. 业务领域建模与系统架构设计**
- **需求深度挖掘**：针对不同健康目标（减脂、增肌、平衡）的用户群体，进行核心业务流程（如热量收支平衡逻辑、动态反馈机制）的深度分析与建模。
- **高可用架构构建**：设计基于 FastAPI 与 Vue.js 3 的前后端分离架构，确保系统在处理高并发接口请求时的低延迟与稳定性。
- **数据模型映射**：构建支撑“多源食物数据库”、“MET 运动模型”及“社交博客交互”的 E-R 关系模型，奠定系统的数据持久化基础。
**2. 基于科学模型的后端服务体系研发**
- **计算引擎实现**：研发基于 Mifflin-St Jeor 公式的 BMR 计算服务，以及基于 MET (Metabolic Equivalent) 标准的运动增量评估逻辑，实现能量代谢的精准量化。
- **AI 专家系统集成**：深度集成 GLM-4.6 大语言模型，通过构建特定的 Prompt 模板，将结构化的营养数据转化为个性化的饮食建议，实现从“数据记录”到“决策支持”的跨越。
- **安全与授权机制**：基于 JWT 方案设计有状态的用户认证体系，确保存储于云端生理数据的安全性与访问控制的严谨性。
**3. 多源营养知识库的构建与异构数据处理**
- **数据治理工程**：针对《中国食物成分表》、USDA FoodData Central 等异构数据源，编写自动化清洗与转换脚本，统一热量与宏量营养素的标准单位。
- **本土化数据库构建**：构建包含热量、蛋白质、脂肪、碳水、钠等多维度的结构化食物知识库，并预留用户自建数据的开放接口。
**4. 响应式交互前端与多维数据可视化**
- **用户体验设计**：利用 Vue.js 3 及 Element Plus 构建响应式单页面应用，降低用户在饮食与运动录入过程中的交互成本。
- **可视化分析引擎**：基于 ECharts 开发健康看板，通过折线图展示“摄入 vs 消耗”的收支趋势，利用进度条实时分析宏量营养素摄入量，通过直观的视觉反馈增强用户的行为依从性。

# 个人饮食运动热量收支平衡系统规划

## 系统建设宗旨

本系统的核心建设宗旨是“科技赋能健康，简化品质生活”。我们致力于打造一个科学、便捷、个性化的个人健康管理工具，旨在帮助用户解决在日常生活中遇到的三大核心痛点：
1. **记录难**：传统的热量和营养素记录方式繁琐且耗时。本系统旨在通过友好的用户界面和智能化的数据输入，将这一过程变得简单、快速。
2. **计算难**：普通用户难以准确计算每日热量需求、运动消耗以及食物中的具体营养成分。本系统旨在通过内置的科学算法和庞大的数据库，将复杂的计算过程自动化，为用户提供清晰、准确的数据反馈。
3. **坚持难**：健康目标的达成需要长期的坚持，而动力的缺乏是普遍的障碍。本系统旨在通过即时的数据反馈、可视化的进步追踪和智能化的正向激励，增强用户的参与感和成就感，帮助他们更容易地将健康行为融入日常生活，最终养成可持续的健康生活方式。

## 系统定位

“Nutri-Plan”系统定位于一个面向大众的、专注于热量与营养管理的健康工具类应用。其主要目标用户群体包括：

1. **体重管理人群**：有明确的减重、增重或塑形需求，希望通过科学控制热量差来达成目标的用户。
2. **健身爱好者**：规律进行体育锻炼，关注蛋白质、碳水化合物等宏量营养素摄入，以期达到更佳运动表现和身体状态的用户。
3. **健康关注者**：希望改善饮食结构、保持均衡营养、预防慢性疾病，追求更健康生活方式的普通大众。

与市场上功能繁杂、大而全的平台型健康应用不同，本系统选择“小而美”的定位，聚焦于“热量收支平衡”这一核心功能，并力求在该领域做到极致。系统的核心竞争力在于：

* **精准与专业**：基于权威的营养学数据库和科学的计算模型，确保数据的准确性。
* **简洁与高效**：提供流畅的用户体验和直观的数据展示，让健康管理变得轻松。
* **智能与个性化**：利用AI技术，从“记录工具”升级为“智能健康助手”，提供千人千面的饮食建议。
* **本地化**：深耕中国用户的饮食习惯，提供更贴近日常生活的食物选择和记录体验。
# 个人饮食运动热量收支平衡系统设计

## 功能结构调查

本系统采用前后端分离的开发模式，通过 RESTful API 实现数据交互与业务逻辑解耦。系统功能划分为五个核心子模块，构建起从“数据采集”到“智能决策”的完整闭环。

### 1. 用户认证与生理画像模块

- **后端实现**：构建基于 JWT 的有状态认证体系，提供注册、登录及生理数据实时同步接口。
- **前端交互**：设计响应式个人中心，并利用 Vue Router 导航守卫建立多级权限控制体系，确保存储于云端的用户生理指标与健康隐私的安全性。
- **优化点**：引入动态生理画像更新机制。当用户更新体重时，后端自动触发基于 Mifflin-St Jeor 公式的 BMR 重新计算任务，确保后续所有推荐逻辑的实时性。

### 2. 多维知识库检索模块

- **后端实现**：基于结构化 MySQL 数据库，提供高性能搜索接口。食物搜索支持基于模糊匹配的热词索引 (`/foods/search/{query}`)；运动库集成 Compendium of Physical Activities 定义的 MET 标准值查询。
- **前端交互**：在记录场景中集成防抖搜索组件，实现毫秒级的响应体验，极大降低用户在庞大数据库中定位特定目标的时间成本。

### 3. 日常跟踪记录模块

- **后端实现**：建立标准化的日志处理引擎，通过 `/log-food` 与 `/log-exercise` 接口分别对摄入与消耗数据进行原子化处理。
- **核心逻辑**：
    - **热量自动换算**：依据 Atwater 系数 自动完成食物克数到热量的换算。
    - **动态增量计算**：依据 MET 模型 实时生成单次运动消耗报告。
- **前端交互**：
    - **交互式汇总看板**：集成 ECharts 可视化引擎，通过多维折线图与饼图展示热量收支趋势与宏量营养素摄入。

### 4. 智能推荐模块

- **后端实现**：深度集成 **GLM-4.6** 接口。后端通过组装“用户生理画像营养学约束”的 Prompt 模板，生成动态饮食方案。
- **前端交互**：提供交互式 AI 咨询界面。用户可以获取当日菜单，实现从单纯的“热量计算器”向“私人健康导师”的职能转变。

### 5. 主页模块

- **前端导航**：作为系统的核心门户，通过磁贴式组件展示当日热量目标完成度、核心营养素进度条及功能入口，增强用户进行日常健康管理的行为动力。

## 系统需求分析

### 前端需求分析

前端应用作为用户与系统交互的直接媒介，其需求聚焦于用户体验、功能实现和数据展示。基于 Vue.js 技术栈，前端需要满足以下核心需求：

#### 1. 高安全性的认证体系
- **闭环认证流**：设计 `Login.vue` 与 `Register.vue`，实现基于正则表达式的客户端校验。
- **无感化授权**：配合 `localStorage` 实现 JWT 的持久化存储。通过 Axios 拦截器 自动在请求头注入 `Authorization` 令牌，确保通信安全。
- **智能路由守卫**：构建动态路由逻辑，根据认证状态自动执行重定向，防止非授权访问

#### 2. 主页仪表盘
- **核心指标聚合**：首页应实时聚合展示当日热量“预算进度条”。通过与后端同步，动态计算并展示：`剩余额度 = 目标 - 摄入 + 消耗`。
- **快捷行动路径**：设计功能的悬浮快捷入口，缩短用户的操作路径。

#### 3. 动态生理画像中心

- **可视化生理趋势**：不仅提供基础资料修改，还需集成体重波动统计小组件。
- **参数联动逻辑**：用户修改身高体重后，前端应即时反馈预估的 BMI 变化，增强用户对生理参数与代谢关系直观感受。

#### 4. 高效饮食与运动跟踪模块

- **饮食追踪 (`FoodTracker.vue`)**：
    - **即时搜索方案**：集成防抖搜索技术，实现毫秒级食物数据库响应。
- **运动追踪 (`ExerciseTracker.vue`)**：
    - **实时热量预览**：用户调节时长滑块时，前端实时利用 `MET * Weight * Time` 公式计算并预览消耗热量，提供即时数据反馈。

#### 5. 多维数据总结与可视化

- **可视化引擎集成**：利用 ECharts 渲染当日营养素分布饼图。
    - **宏量营养素分析**：展示碳水、蛋白质、脂肪的供能占比。
    - **热量收支图**：直观展示当日达成度，通过颜色变化（绿/橙/红）警示热量超标。

#### 6. AI 智能交互中心

- **健康建议**：根据用户当天的饮食和运动日志，返回 AI 鼓励性建议。
- **结构化展示**：将 AI 返回的非结构化文本通过前端解析为“三餐卡片”形式，包含食物建议及其预估热量占比。
- **一键记录集成**：支持用户将 AI 推荐的菜单直接“一键添加”至当日饮食记录，简化决策到行为的转化。

#### 7. 用户社交社区模块

- **瀑布流动态展示**：通过无限滚动技术展示社区动态，支持文字、图片（饮食打卡、健身效果）的展示。
- **社交互动机制**：
    - **点赞与评论**：实现实时交互，增加用户健康打卡的心理激励。
    - **健康话题标签**：支持按 `#减脂`、`#增肌` 等标签分类筛选内容。
- **个人发布端**：提供文本或简易发布组件，集成图片上传功能，允许用户分享其健康成果，构建“打卡-获赞-坚持”的正向激励闭环。  

### 后端需求分析

后端服务是整个系统的“大脑”，负责处理业务逻辑、数据存储和安全认证。基于FastAPI和SQLAlchemy技术栈，后端需要满足以下核心需求：

#### 1.API 架构与安全

- **异步并发处理**：利用 FastAPI 的 `async/await` 特性，非阻塞地处理 AI 接口调用与数据库 I/O，确保在高并发请求下系统不发生拥塞。
- **多层数据校验**：基于 Pydantic 实现请求与响应的双向校验。
- **鉴权体系**：采用  JWT (RS256加密) 实现无状态认证。密码采用 `passlib[bcrypt]` 进行单向哈希加密，确保数据库即便泄露也无法还原明文密码。
- **CORS 与中间件**：配置严格的跨源资源共享策略，并集成日志中间件，记录关键业务流转与接口异常。

#### 2.动态生理画像引擎

- **自动化 BMR/TDEE 计算**：实现 Mifflin-St Jeor 算法服务类。后端在用户生理数据更新时，自动重算其代谢基准。
- **个性化目标推演**：根据用户设定的目标（减脂/增肌/维持），动态下发每日热量缺口指标。
#### 3. 营养学算法核心模块

- **高精度能量累加器**：
    - **摄入端**：基于 Atwater 系数，根据 `serving_grams` 实时换算宏量营养素供能比。
    - **消耗端**：建立 MET 动态计算引擎。逻辑公式：$EAT = MET \times Weight_{current} \times Duration(h)$。
- **每日总结聚合接口**：后端最核心的聚合服务。需实现多表联查与逻辑合并，返回包含：基础代谢、活动增量、摄入总量、宏量比例等复合 JSON 对象。
#### 4. AI 驱动的专家决策系统

- **Prompt 模板工程**：构建专业的上下文注入机制。后端需自动抓取用户的 BMR、TDEE、饮食禁忌等，组装成结构化指令发送给 GLM-4.6。

#### 5. 社交互动与内容分发模块

- **动态发布系统 (`/blogs`)**：
    - 支持图文混合内容的存储。集成云存储（如阿里云 OSS/MinIO）进行图片处理，后端仅存储图片 URL。
    - 提供基于时间的流式分页接口，确保社交列表加载的流畅性。
- **交互状态管理**：
    - **点赞逻辑**：采用原子化操作处理点赞数统计，防止并发冲突。
    - **评论树构建**：设计支持二级回复的评论数据结构，增强社区讨论深度。
- **内容关联引擎**：支持动态关联“当日健康报告”，实现用户一键分享其运动成果或饮食组合。

#### 6. 数据库事务与资源管理

- **Session 生命周期**：利用 FastAPI 的 `Dependency Injection` 模式管理 SQLAlchemy `SessionLocal`，确保每个请求事务的原子性与自动关闭。

## 系统业务流程

本系统的业务流程旨在为用户提供一个闭环的、持续的健康管理体验。核心流程可以分为“初次使用”和“日常使用”两个阶段。

**1. 初次使用流程**

 - **流程描述**：
    1. **账户鉴权**：用户通过 `/register` 与 `/login` 建立数字身份，系统下发 JWT 建立安全会话。
    2. **生理画像建模**：用户录入性别、生日、身高、体重及静态活动水平（PAL）。
    3. **目标基准确立**：后端调用 **Mifflin-St Jeor 服务**计算 BMR，并根据用户选定的目标（减脂/增肌/维持）自动推演每日热量预算阈值。
- **优化点**：系统在画像完成后自动生成一份“初始健康分析报告”，建立用户的第一印象。

**2.双驱动记录流程**

- **饮食记录支线**：用户通过模糊搜索定位食物 $\rightarrow$ 输入克重 $\rightarrow$ 后端计算热量与三大营养素 $\rightarrow$ 更新 `user_food_log`。
- **运动记录支线**：用户选择项目 $\rightarrow$ 输入时长 $\rightarrow$ 后端调用 MET 引擎 结合当前体重计算动态消耗 $\rightarrow$ 更新 `user_exercise_log`。    
- **数据流转**：所有记录操作均会实时触发主页仪表盘的“能量仪表盘”刷新，实现摄入与支出的动态对冲展示。

**3. 智能分析与社交激励流程**

- **可视化反馈**：用户访问“每日总结”，系统实时聚合当日数据，通过 ECharts 渲染营养素比例饼图与热量平衡环形图。
- **AI 纠偏建议**：用户触发 AI 模块，系统组装当前收支余量快照发送至 GLM-4.6，获取后续方案建议。

**4. 用户社区互动流程**

- **打卡分享流**：
    1. **内容发布**：用户在社区模块编写心得并配图，发布至 `blogs` 动态流。
    2. **社交反馈**：社区其他用户进行点赞或评论互动，后端通过推送机制（或轮询）通知原作者。
- **价值闭环**：社交互动产生的“正面情绪反馈”能有效对冲健康管理初期的枯燥感，通过社区达人的饮食分享，用户可获得非系统预设的、更具烟火气的饮食灵感，实现从“单机记录”向“社区共建”的转化。

## 数据字典

### 表结构定义

本节定义了系统数据库中的主要数据实体（表）及其属性（字段）。数据库名为 `nutri_plan`。

**1. `users` - 用户信息表**：存储用户的基本信息、身体数据和健康目标。

| **字段名**           | **数据类型**     | **约束**                      | **备注 / 含义**                |
| ----------------- | ------------ | --------------------------- | -------------------------- |
| `id`              | INT          | PRIMARY KEY, AUTO_INCREMENT | 用户的唯一内部标识                  |
| `username`        | VARCHAR(50)  | UNIQUE, NOT NULL            | 用户昵称，用于社区展示                |
| `email`           | VARCHAR(100) | UNIQUE, NOT NULL            | 电子邮箱，作为唯一登录账号              |
| `hashed_password` | VARCHAR(255) | NOT NULL                    | 采用 Bcrypt 算法加密后的安全密码       |
| `gender`          | ENUM         | 'male', 'female'            | 性别，用于 Mifflin-St Jeor 公式计算 |
| `birthdate`       | DATE         | NOT NULL                    | 出生日期，用于动态计算年龄及代谢率          |
| `height_cm`       | DECIMAL(5,2) | NOT NULL                    | 身高（厘米），支持精确到小数点后两位         |
| `weight_kg`       | DECIMAL(5,2) | NOT NULL                    | 体重（公斤），计算 BMR 与运动消耗的基准     |
| `activity_level`  | ENUM         | 'sedentary'...              | 活动水平系数，用于推算 TDEE           |
| `goal`            | ENUM         | 'lose', 'gain', 'maintain'  | 健康目标（减重、增肌、维持）             |
| `created_at`      | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP   | 账号注册时间                     |
| `updated_at`      | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP   | 资料最后一次修改时间                 |

**2. `foods` - 食物营养信息表**：存储食物的详细营养成分信息。

| **字段名**           | **数据类型**     | **约束**                      | **备注 / 含义**              |     |
| ----------------- | ------------ | --------------------------- | ------------------------ | --- |
| `id`              | BIGINT       | PRIMARY KEY, AUTO_INCREMENT | 食物唯一 ID，由于数据量大采用 BIGINT  |     |
| `description_zh`  | VARCHAR(255) | NOT NULL                    | 食物中文名称                   |     |
| `description_en`  | VARCHAR(255) | -                           | 食物英文名称                   |     |
| `energy_kcal`     | DECIMAL(7,2) | NOT NULL                    | 每 100g 热量（kcal）          |     |
| `protein_g`       | DECIMAL(5,2) | DEFAULT 0.00                | 每 100g 蛋白质含量（g）          |     |
| `fat_g`           | DECIMAL(5,2) | DEFAULT 0.00                | 每 100g 脂肪含量（g）           |     |
| `carbohydrate_g`  | DECIMAL(5,2) | DEFAULT 0.00                | 每 100g 碳水化合物含量（g）        |     |
| `fiber_g`         | DECIMAL(5,2) | DEFAULT 0.00                | 每 100g 膳食纤维含量（g）         |     |
| `sugars_g`        | DECIMAL(5,2) | DEFAULT 0.00                | 每 100g 糖分含量（g）           |     |
| `sodium_mg`       | DECIMAL(7,2) | DEFAULT 0.00                | 每 100g 钠含量（mg），用于高血压饮食预警 |     |
| `iron_mg`         | DECIMAL(5,2) | DEFAULT 0.00                | 每 100g 铁含量（mg）           |     |
| `source`          | VARCHAR(50)  | -                           | 数据来源（如：USDA, 中国营养成分表第6版） |     |
| `is_high_protein` | BOOLEAN      | DEFAULT FALSE               | 预计算标签：是否属于高蛋白食物          |     |
| `is_low_carb`     | BOOLEAN      | DEFAULT FALSE               | 预计算标签：是否属于低碳水食物          |     |

**3. `exercises` - 运动热量消耗系数表**

| **字段名**       | **数据类型**     | **约束**                      | **备注 / 含义**               |
| ------------- | ------------ | --------------------------- | ------------------------- |
| `id`          | INT          | PRIMARY KEY, AUTO_INCREMENT | 运动项目的唯一内部 ID              |
| `name`        | VARCHAR(100) | UNIQUE, NOT NULL            | 运动名称（如：慢跑 8km/h、游泳、瑜伽）    |
| `met_value`   | DECIMAL(4,1) | NOT NULL                    | 代谢当量（MET）：计算能量消耗的关键系数     |
| `description` | TEXT         | -                           | 运动细节描述或标准动作指导建议           |


**4. `user_food_log` - 用户每日饮食记录表**：记录用户在特定日期摄入了哪些食物以及摄入量。

| **字段名**          | **数据类型**     | **约束**                                  | **备注 / 含义**              |
| ---------------- | ------------ | --------------------------------------- | ------------------------ |
| `id`             | INT          | PRIMARY KEY, AUTO_INCREMENT             | 记录的唯一标识 ID               |
| `user_id`        | INT          | FOREIGN KEY (`users.id`)                | 关联的用户 ID，标识该记录归属         |
| `food_id`        | INT          | FOREIGN KEY (`foods.id`)                | 关联的食物 ID，用于获取营养素单价       |
| `serving_grams`  | DECIMAL(7,2) | NOT NULL                                | 用户本次摄入的重量（单位：克）          |
| `meal_type`      | ENUM         | 'breakfast', 'lunch', 'dinner', 'snack' | 用餐时段，用于饮食结构分析            |
| `total_calories` | DECIMAL(8,2) | -                                       | **冗余字段**：本次摄入的总热量（预计算存储） |
| `log_date`       | DATE         | NOT NULL                                | 记录所属日期，用于每日总结聚合          |
| `created_at`     | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP               | 实际记录提交的系统时间              |


**5. `user_exercise_log` - 用户每日运动记录表**：记录用户在特定日期进行了哪些运动以及持续时间。

| **字段名**            | **数据类型**     | **约束**                       | **备注 / 含义**                  |
| ------------------ | ------------ | ---------------------------- | ---------------------------- |
| `id`               | INT          | PRIMARY KEY, AUTO_INCREMENT  | 运动记录的唯一内部 ID                 |
| `user_id`          | INT          | FOREIGN KEY (`users.id`)     | 关联的用户 ID，标识该记录归属             |
| `exercise_id`      | INT          | FOREIGN KEY (`exercises.id`) | 关联的具体运动项目 ID                 |
| `duration_minutes` | INT          | NOT NULL                     | 运动持续时长（分钟）                   |
| `calories_burned`  | DECIMAL(7,2) | NOT NULL                     | **计算结果**：由后端根据 MET 公式生成的消耗热量 |
| `log_date`         | DATE         | NOT NULL                     | 运动发生的日期，用于每日收支平衡计算           |
| `created_at`       | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP    | 记录录入系统的精确时间                  |


**6. `blogs` - 社区动态表**：存储用户发布的社区动态，支持文字、图片分享以及社交点赞功能。

| **字段名**       | **数据类型**     | **约束**                      | **备注 / 含义**                 |
| ------------- | ------------ | --------------------------- | --------------------------- |
| `id`          | INT          | PRIMARY KEY, AUTO_INCREMENT | 动态的唯一标识 ID                  |
| `user_id`     | INT          | FOREIGN KEY (`users.id`)    | 发布者 ID，关联用户表                |
| `title`       | VARCHAR(100) | NOT NULL                    | 动态标题，用于概括分享主题               |
| `content`     | TEXT         | NOT NULL                    | 动态正文，记录心情、健身心得或饮食经验         |
| `image_url`   | VARCHAR(255) | -                           | 封面或配图的云存储地址（如 OSS/MinIO 路径） |
| `likes_count` | INT          | DEFAULT 0                   | 被点赞的总数，用于社交热度统计             |
| `is_public`   | BOOLEAN      | DEFAULT TRUE                | 是否公开（支持设置为仅自己可见）            |
| `created_at`  | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP   | 发布时间，用于社区流的时间排序             |
| `updated_at`  | TIMESTAMP    | DEFAULT CURRENT_TIMESTAMP   | 最后一次修改的时间                   |

**7. `blog_comments` - 评论表**：存储用户对博客动态的评论内容。

| **字段名**      | **数据类型**  | **约束**                      | **备注 / 含义**                |
| ------------ | --------- | --------------------------- | -------------------------- |
| `id`         | INT       | PRIMARY KEY, AUTO_INCREMENT | 评论的唯一标识 ID                 |
| `blog_id`    | INT       | FOREIGN KEY (`blogs.id`)    | 关联的博客动态 ID，标识该评论所属的内容      |
| `user_id`    | INT       | FOREIGN KEY (`users.id`)    | 评论发布者的用户 ID                |
| `content`    | TEXT      | NOT NULL                    | 评论的具体文字内容                  |
| `parent_id`  | INT       | DEFAULT NULL                | **用于二级评论**：指向父评论 ID，实现回复功能 |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP   | 评论发布的系统时间                  |

### 表关系

**1. 用户-饮食记录 (User-FoodLog)**: 一对多关系
* 一个用户可以有多条饮食记录。
* 一条饮食记录只属于一个`用户`。
* 实现方式: 通过 `user_food_log` 连接。

**2. 用户-运动记录 (User-ExerciseLog)**: 一对多关系
* 一个`用户`可以有多条`运动记录`。
* 一条`运动记录`只属于一个`用户`。
* 实现方式: 通过 `user_exercise_log` 连接。

**3. 食物-饮食记录 (Food-FoodLog)**: 一对多关系
* 一个`食物`可以出现在多条`饮食记录`中。
* 一条`饮食记录`只对应一个`食物`。
* 实现方式: `user_food_log` 表中的 `food_id` 作为外键关联 `foods.id`。

**4. 运动-运动记录 (Exercise-ExerciseLog)**: 一对多关系
* 一个`运动`可以出现在多条`运动记录`中。
* 一条`运动记录`只对应一个`运动`。
* 实现方式: `user_exercise_log` 表中的 `exercise_id` 作为外键关联 `exercises.id`。

**5. 动态-评论 (Blog-Comment)**: 一对多关系
- **业务逻辑**:
    - 一个动态可以拥有多条评论。
    - 每一条评论必须且仅能归属于一个特定的`动态`。
- **实现方式**: `blog_comments` 表中的 `blog_id` 作为外键，关联 `blogs.id`。当主动态被删除时，触发级联删除以清理相关评论。

**6. 评论-回复**: 自引用一对多关系
- **业务逻辑**:
    - 一条父级评论可以拥有多条子级回复。
    - 每一条回复通过指向父级 ID 来明确其在评论树中的位置。
- **实现方式**: `blog_comments` 表中的 `parent_id` 作为外键，关联本表自身的 `id`。
    - 若 `parent_id` 为 `NULL`，则该记录为针对动态的一级评论。
    - 若 `parent_id` 存在数值，则该记录为针对特定评论的回复。

**7. 用户-动态/评论**: 一对多关系
- **业务逻辑**:
    - 一个用户可以发布多篇`动态`。
    - 一个用户也可以发表多条`评论`。
- **实现方式**:
    - `blogs` 表中的 `user_id` 关联 `users.id`。
    - `blog_comments` 表中的 `user_id` 关联 `users.id`。

# 总结与规划

本项目旨在通过 Vue.js 3 与 FastAPI 的前后端分离架构，构建一个具备闭环管理能力的个人热量收支平衡系统——Nutri-Plan。系统不仅实现了精准的能量代谢模型计算（BMR/TDEE/MET），还通过 ECharts 可视化与 AI 的集成，将传统的记录工具转化为决策助手。这一方案充分体现了现代 Web 技术在解决亚健康管理、提升用户依从性方面的应用价值。

在接下来的开发周期内，本项目将重点围绕以下核心功能进行深度实现与集成：

**1. 生理画像建模与代谢计算引擎**

- **动态生理档案管理**：构建用户画像系统，收集用户的性别、年龄、身高、体重及日常活动强度。后端利用 Pydantic 模型进行数据校验，确保输入参数符合人体生理极限范围。
- **计算引擎集成**：在服务端集成了 Mifflin-St Jeor 公式，用于计算用户的 BMR 等数据。

**2. 饮食与运动的 CRUD 核心逻辑**

- **食物热量动态换算系统**：开发了基于“单价-总量”逻辑的饮食记录接口。用户在选择食物后，前端通过监听 `serving_grams` 字段的变动，实时调用换算逻辑：$总热量 = (食物单价热量 / 100) \times 摄入克数$。
- **基于 MET 值的运动消耗**：在运动记录模块中，引入了国际通用的 MET 评估体系。系统通过公式 $消耗热量 = MET \times 体重(kg) \times (时长(min) / 60)$ 自动计算单次运动的净支出。        

**3. 社交驱动模块：用户健康社区的构建**

- **互动闭环实现**：开发社区动态发布系统，支持用户上传饮食打卡与运动心得，通过社交互动提升用户管理健康的主动性。
- **数据分享链路**：实现将当日“热量收支看板”一键转化为社交动态的功能，将个人管理数据转化为社区激励内容。

**4. 智能决策增强：AI 饮食推荐的深度定制**

- **多维度上下文注入**：优化向 AI 接口发送的 Prompt 结构。后端将根据用户的历史过敏源、饮食偏好（如：低盐、高蛋白需求）以及当日剩余热量缺口，实现精准的“千人千面”菜单定制。
- **结构化输出处理**：完善 AI 返回数据的解析逻辑，将文本建议自动转化为可直接“一键添加”至饮食记录的结构化卡片。

**5. 数据可视化深度挖掘**

- **多维营养素追踪**：在热量统计的基础上，完善对蛋白质、脂肪、碳水化合物（三大宏量营养素）以及钠、铁微量元素的实时占比分析。
- **长效趋势预测**：利用 Canvas 开发用户体重与热量平衡的历史趋势分析组件，通过可视化的方式帮助用户直观感知阶段性的健康变化。